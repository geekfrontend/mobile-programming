---
title: Pertemuan 8 - Integrasi API dengan Fetch & Axios
description: Mempelajari cara mengintegrasikan API REST ke dalam aplikasi React Native menggunakan Fetch API dan Axios.
---

## ðŸ“Œ Pertemuan 8: Integrasi API dengan Fetch & Axios

**API Integration** adalah proses menghubungkan aplikasi mobile dengan server backend untuk mengambil, mengirim, atau memanipulasi data.  
React Native menyediakan **Fetch API** bawaan, dan kita juga bisa menggunakan library **Axios** untuk HTTP requests yang lebih powerful.

---

### ðŸŒ Apa itu REST API?

**REST (Representational State Transfer)** adalah arsitektur untuk web services yang menggunakan HTTP methods:

- **GET** â†’ Mengambil data
- **POST** â†’ Mengirim data baru
- **PUT/PATCH** â†’ Mengupdate data
- **DELETE** â†’ Menghapus data

```
GET    /api/users        â†’ Ambil semua users
GET    /api/users/123    â†’ Ambil user dengan ID 123
POST   /api/users        â†’ Buat user baru
PUT    /api/users/123    â†’ Update user dengan ID 123
DELETE /api/users/123    â†’ Hapus user dengan ID 123
```

---

### ðŸ”„ Fetch API - Native JavaScript

Fetch adalah API bawaan JavaScript untuk melakukan HTTP requests.

#### GET Request

```jsx
import React, { useState, useEffect } from 'react';
import { View, Text, FlatList, ActivityIndicator } from 'react-native';

export default function UserList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetchUsers();
  }, []);

  const fetchUsers = async () => {
    try {
      setLoading(true);
      const response = await fetch('https://jsonplaceholder.typicode.com/users');
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      setUsers(data);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <ActivityIndicator size="large" />;
  if (error) return <Text>Error: {error}</Text>;

  return (
    <FlatList
      data={users}
      keyExtractor={(item) => item.id.toString()}
      renderItem={({ item }) => (
        <View style={styles.userItem}>
          <Text style={styles.userName}>{item.name}</Text>
          <Text style={styles.userEmail}>{item.email}</Text>
        </View>
      )}
    />
  );
}
```

#### POST Request

```jsx
const createUser = async (userData) => {
  try {
    const response = await fetch('https://jsonplaceholder.typicode.com/users', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(userData),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const newUser = await response.json();
    console.log('User created:', newUser);
    return newUser;
  } catch (error) {
    console.error('Error creating user:', error);
    throw error;
  }
};

// Penggunaan
const handleCreateUser = async () => {
  const userData = {
    name: 'John Doe',
    email: 'john@example.com',
    phone: '123-456-7890'
  };

  try {
    await createUser(userData);
    // Refresh user list
    fetchUsers();
  } catch (error) {
    setError('Failed to create user');
  }
};
```

---

### ðŸ“¦ Axios - HTTP Client Library

Axios adalah library yang lebih powerful dan user-friendly untuk HTTP requests.

#### Instalasi Axios

```bash
npm install axios
```

#### Setup Axios Instance

```jsx
// api/client.ts
import axios from 'axios';

const apiClient = axios.create({
  baseURL: 'https://jsonplaceholder.typicode.com',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor
apiClient.interceptors.request.use(
  (config) => {
    // Add auth token if available
    const token = getAuthToken();
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response interceptor
apiClient.interceptors.response.use(
  (response) => {
    return response;
  },
  (error) => {
    if (error.response?.status === 401) {
      // Handle unauthorized access
      logout();
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

#### GET Request dengan Axios

```jsx
import apiClient from '../api/client';

export default function UserListAxios() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetchUsers();
  }, []);

  const fetchUsers = async () => {
    try {
      setLoading(true);
      const response = await apiClient.get('/users');
      setUsers(response.data);
    } catch (err) {
      setError(err.response?.data?.message || err.message);
    } finally {
      setLoading(false);
    }
  };

  // Component render logic sama seperti sebelumnya
}
```

#### POST Request dengan Axios

```jsx
const createUser = async (userData) => {
  try {
    const response = await apiClient.post('/users', userData);
    return response.data;
  } catch (error) {
    throw new Error(error.response?.data?.message || error.message);
  }
};
```

---

### ðŸ”§ Custom Hook untuk API

Membuat custom hook untuk reusable API logic:

```jsx
// hooks/useApi.ts
import { useState, useEffect } from 'react';
import apiClient from '../api/client';

export const useApi = (url, options = {}) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const fetchData = async () => {
    try {
      setLoading(true);
      setError(null);
      const response = await apiClient.get(url, options);
      setData(response.data);
    } catch (err) {
      setError(err.response?.data?.message || err.message);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, [url]);

  const refetch = () => {
    fetchData();
  };

  return { data, loading, error, refetch };
};

// Penggunaan
export default function ProductList() {
  const { data: products, loading, error, refetch } = useApi('/products');

  if (loading) return <ActivityIndicator />;
  if (error) return <Text>Error: {error}</Text>;

  return (
    <View>
      <TouchableOpacity onPress={refetch}>
        <Text>Refresh</Text>
      </TouchableOpacity>
      <FlatList
        data={products}
        renderItem={({ item }) => <ProductItem product={item} />}
      />
    </View>
  );
}
```

---

### ðŸ”¹ Mutation Hook untuk POST/PUT/DELETE

```jsx
// hooks/useMutation.ts
import { useState } from 'react';
import apiClient from '../api/client';

export const useMutation = (url, method = 'POST') => {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const mutate = async (data) => {
    try {
      setLoading(true);
      setError(null);
      
      let response;
      switch (method.toLowerCase()) {
        case 'post':
          response = await apiClient.post(url, data);
          break;
        case 'put':
          response = await apiClient.put(url, data);
          break;
        case 'patch':
          response = await apiClient.patch(url, data);
          break;
        case 'delete':
          response = await apiClient.delete(url);
          break;
        default:
          throw new Error(`Unsupported method: ${method}`);
      }
      
      return response.data;
    } catch (err) {
      const errorMessage = err.response?.data?.message || err.message;
      setError(errorMessage);
      throw new Error(errorMessage);
    } finally {
      setLoading(false);
    }
  };

  return { mutate, loading, error };
};

// Penggunaan
export default function CreateUserForm() {
  const { mutate: createUser, loading, error } = useMutation('/users', 'POST');
  const [formData, setFormData] = useState({ name: '', email: '' });

  const handleSubmit = async () => {
    try {
      await createUser(formData);
      Alert.alert('Success', 'User created successfully!');
      setFormData({ name: '', email: '' });
    } catch (error) {
      Alert.alert('Error', error.message);
    }
  };

  return (
    <View>
      <TextInput
        placeholder="Name"
        value={formData.name}
        onChangeText={(text) => setFormData(prev => ({ ...prev, name: text }))}
      />
      <TextInput
        placeholder="Email"
        value={formData.email}
        onChangeText={(text) => setFormData(prev => ({ ...prev, email: text }))}
      />
      <TouchableOpacity onPress={handleSubmit} disabled={loading}>
        <Text>{loading ? 'Creating...' : 'Create User'}</Text>
      </TouchableOpacity>
      {error && <Text style={styles.error}>{error}</Text>}
    </View>
  );
}
```

---

### ðŸ” Authentication & Token Management

```jsx
// utils/auth.ts
import AsyncStorage from '@react-native-async-storage/async-storage';

const TOKEN_KEY = 'auth_token';

export const saveToken = async (token) => {
  try {
    await AsyncStorage.setItem(TOKEN_KEY, token);
  } catch (error) {
    console.error('Error saving token:', error);
  }
};

export const getToken = async () => {
  try {
    return await AsyncStorage.getItem(TOKEN_KEY);
  } catch (error) {
    console.error('Error getting token:', error);
    return null;
  }
};

export const removeToken = async () => {
  try {
    await AsyncStorage.removeItem(TOKEN_KEY);
  } catch (error) {
    console.error('Error removing token:', error);
  }
};

// Login function
export const login = async (email, password) => {
  try {
    const response = await apiClient.post('/auth/login', {
      email,
      password,
    });

    const { token, user } = response.data;
    await saveToken(token);
    
    return { token, user };
  } catch (error) {
    throw new Error(error.response?.data?.message || 'Login failed');
  }
};
```

---

### ðŸ”¹ Error Handling & Loading States

```jsx
// components/ApiWrapper.tsx
import React from 'react';
import { View, Text, TouchableOpacity, ActivityIndicator } from 'react-native';

export const ApiWrapper = ({ 
  loading, 
  error, 
  onRetry, 
  children,
  loadingComponent,
  errorComponent 
}) => {
  if (loading) {
    return loadingComponent || (
      <View style={styles.centered}>
        <ActivityIndicator size="large" />
        <Text>Loading...</Text>
      </View>
    );
  }

  if (error) {
    return errorComponent || (
      <View style={styles.centered}>
        <Text style={styles.errorText}>Something went wrong</Text>
        <Text style={styles.errorMessage}>{error}</Text>
        {onRetry && (
          <TouchableOpacity style={styles.retryButton} onPress={onRetry}>
            <Text style={styles.retryText}>Try Again</Text>
          </TouchableOpacity>
        )}
      </View>
    );
  }

  return children;
};

// Penggunaan
export default function ProductScreen() {
  const { data, loading, error, refetch } = useApi('/products');

  return (
    <ApiWrapper loading={loading} error={error} onRetry={refetch}>
      <FlatList
        data={data}
        renderItem={({ item }) => <ProductItem product={item} />}
      />
    </ApiWrapper>
  );
}
```

---

### ðŸŽ¯ Studi Kasus: E-Commerce API Integration

```jsx
// services/productService.ts
import apiClient from '../api/client';

export const productService = {
  // Get all products
  getProducts: async (page = 1, limit = 10) => {
    const response = await apiClient.get(`/products?page=${page}&limit=${limit}`);
    return response.data;
  },

  // Get product by ID
  getProduct: async (id) => {
    const response = await apiClient.get(`/products/${id}`);
    return response.data;
  },

  // Search products
  searchProducts: async (query) => {
    const response = await apiClient.get(`/products/search?q=${query}`);
    return response.data;
  },

  // Get products by category
  getProductsByCategory: async (categoryId) => {
    const response = await apiClient.get(`/products/category/${categoryId}`);
    return response.data;
  },
};

// services/cartService.ts
export const cartService = {
  // Get user cart
  getCart: async () => {
    const response = await apiClient.get('/cart');
    return response.data;
  },

  // Add item to cart
  addToCart: async (productId, quantity = 1) => {
    const response = await apiClient.post('/cart/items', {
      productId,
      quantity,
    });
    return response.data;
  },

  // Update cart item
  updateCartItem: async (itemId, quantity) => {
    const response = await apiClient.put(`/cart/items/${itemId}`, {
      quantity,
    });
    return response.data;
  },

  // Remove item from cart
  removeFromCart: async (itemId) => {
    const response = await apiClient.delete(`/cart/items/${itemId}`);
    return response.data;
  },
};
```

---

### ðŸ”¹ Offline Support & Caching

```jsx
// utils/cache.ts
import AsyncStorage from '@react-native-async-storage/async-storage';

const CACHE_PREFIX = 'api_cache_';
const CACHE_EXPIRY = 5 * 60 * 1000; // 5 minutes

export const cacheData = async (key, data) => {
  try {
    const cacheItem = {
      data,
      timestamp: Date.now(),
    };
    await AsyncStorage.setItem(CACHE_PREFIX + key, JSON.stringify(cacheItem));
  } catch (error) {
    console.error('Error caching data:', error);
  }
};

export const getCachedData = async (key) => {
  try {
    const cached = await AsyncStorage.getItem(CACHE_PREFIX + key);
    if (!cached) return null;

    const cacheItem = JSON.parse(cached);
    const isExpired = Date.now() - cacheItem.timestamp > CACHE_EXPIRY;
    
    if (isExpired) {
      await AsyncStorage.removeItem(CACHE_PREFIX + key);
      return null;
    }

    return cacheItem.data;
  } catch (error) {
    console.error('Error getting cached data:', error);
    return null;
  }
};

// Enhanced useApi hook with caching
export const useApiWithCache = (url, options = {}) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const fetchData = async (useCache = true) => {
    try {
      setLoading(true);
      setError(null);

      // Try to get cached data first
      if (useCache) {
        const cachedData = await getCachedData(url);
        if (cachedData) {
          setData(cachedData);
          setLoading(false);
          return;
        }
      }

      const response = await apiClient.get(url, options);
      setData(response.data);
      
      // Cache the response
      await cacheData(url, response.data);
    } catch (err) {
      setError(err.response?.data?.message || err.message);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, [url]);

  const refetch = () => fetchData(false);

  return { data, loading, error, refetch };
};
```

---

### ðŸŽ¯ Latihan

1. **User Management** â†’ Buat CRUD untuk user (Create, Read, Update, Delete)
2. **Product Catalog** â†’ Implementasi product list dengan search dan filter
3. **Shopping Cart** â†’ Buat shopping cart dengan API integration
4. **Authentication Flow** â†’ Implementasi login/logout dengan token management
5. **Offline Support** â†’ Tambahkan caching untuk offline functionality

**Best Practices:**
- Selalu handle loading dan error states
- Gunakan interceptors untuk common logic (auth, logging)
- Implement proper error handling dan user feedback
- Cache data untuk better performance
- Use TypeScript untuk type safety